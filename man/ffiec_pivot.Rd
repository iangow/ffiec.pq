% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ffiec_pivot.R
\name{ffiec_pivot}
\alias{ffiec_pivot}
\title{Pivot long FFIEC data to wide format using DuckDB}
\usage{
ffiec_pivot(
  data,
  id_cols = c("IDRSSD", "date"),
  names_from = "item",
  values_from = "value",
  items = NULL,
  values_fn = "first"
)
}
\arguments{
\item{data}{A DuckDB-backed lazy \code{tbl} containing the long data to pivot.}

\item{id_cols}{Character vector of identifier columns that define unique rows
in the wide output (default \code{c("IDRSSD", "date")}).}

\item{names_from}{Character scalar giving the column whose values become
output column names (default \code{"item"}).}

\item{values_from}{Character scalar giving the column that supplies cell
values (default \code{"value"}).}

\item{items}{Optional character vector of values of \code{names_from} to
include. When supplied, the input is filtered to \code{names_from \%in\% items}
before pivoting, and DuckDB is instructed to pivot only those columns. This
is recommended when you want a stable set/order of output columns.}

\item{values_fn}{Character scalar naming a DuckDB aggregate function used to
resolve multiple values per \code{id_cols + names_from} combination. The
default is \code{"any_value"}, which is appropriate when uniqueness holds.
Other common choices include \code{"sum"}, \code{"max"}, or \code{"min"}.}
}
\value{
A DuckDB-backed lazy \code{tbl} in wide format.
}
\description{
Creates a wide table from a DuckDB-backed lazy \code{tbl} containing long
FFIEC data (typically columns like \code{IDRSSD}, \code{date}, \code{item},
\code{value}). This is a lightweight, fast alternative to
[tidyr::pivot_wider()] that pushes the pivot operation into DuckDB.
}
\details{
The function is designed for use with tables returned by [ffiec_scan_pqs()]
(or any DuckDB-backed lazy \code{tbl}). The DuckDB connection is inferred
from \code{data}.


This helper supports a minimal subset of the [tidyr::pivot_wider()] interface:
\code{data}, \code{id_cols}, \code{names_from}, and \code{values_from}, plus
optional \code{items} and \code{values_fn}.

For best results, ensure that \code{id_cols} combined with \code{names_from}
uniquely identify rows in \code{data}. If not, choose an appropriate
\code{values_fn} to aggregate duplicates.
}
\examples{
\dontrun{
db <- DBI::dbConnect(duckdb::duckdb())

# Long table: IDRSSD, date, item, value
ffiec_float <- ffiec_scan_pqs(db, schedule = "ffiec_float")

fields <- c("RCFD0081", "RCON0081", "RCFD0071", "RCON0071")

wide <- ffiec_pivot(
  data = ffiec_float,
  id_cols = c("IDRSSD", "date"),
  names_from = "item",
  values_from = "value",
  items = fields,
  values_fn = "any_value"
)

wide |> dplyr::glimpse()
}

}
