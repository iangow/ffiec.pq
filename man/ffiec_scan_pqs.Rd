% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ffiec_manifest.R
\name{ffiec_scan_pqs}
\alias{ffiec_scan_pqs}
\title{Scan FFIEC Parquet files into DuckDB}
\usage{
ffiec_scan_pqs(
  conn,
  schedule = NULL,
  pq_file = NULL,
  data_dir = NULL,
  schema = "ffiec",
  prefix = "",
  union_by_name = TRUE,
  keep_filename = FALSE
)
}
\arguments{
\item{conn}{A valid DuckDB connection.}

\item{schedule}{Optional character scalar giving the FFIEC schedule
name (e.g. \code{"rc"}, \code{"rci"}, \code{"rcb"}). All matching Parquet
files of the form \code{\{prefix\}\{schedule\}_YYYYMMDD.parquet} are scanned.}

\item{pq_file}{Optional character scalar giving a Parquet filename or
glob pattern. May be a base name or relative path within the resolved
Parquet directory, or a fully qualified path when \code{data_dir} is
not supplied.}

\item{data_dir}{Optional parent directory for Parquet files. If \code{NULL},
the environment variable \code{DATA_DIR} is used.}

\item{schema}{Schema name used to resolve the Parquet directory
(default \code{"ffiec"}). Set to \code{NULL} to treat \code{data_dir}
(or \code{DATA_DIR}) as the final Parquet directory.}

\item{prefix}{Optional filename prefix used when the Parquet files
were created (default \code{""}).}

\item{union_by_name}{Logical; whether to union Parquet files by column
name when scanning multiple files (passed to DuckDB's
\code{read_parquet()}). Default is \code{TRUE}.}

\item{keep_filename}{Logical; whether to keep the original Parquet file name (passed to DuckDB's
\code{read_parquet()}). Default is \code{FALSE}.}
}
\value{
A lazy \code{tbl} backed by DuckDB.
}
\description{
Create a lazy \code{tbl} backed by DuckDB by scanning one or more FFIEC
Parquet files. Files may be selected either by FFIEC schedule name
or by an explicit Parquet filename or glob pattern. No data is read
eagerly; evaluation occurs only when the result is collected.
}
\details{
This function is intended for use with Parquet files produced by
[ffiec_process()]. It validates that the requested files exist on
disk before constructing the DuckDB query.


Exactly one of \code{schedule} or \code{pq_file} must be supplied.

\strong{Directory resolution}

By default, Parquet files are read from a schema subdirectory:
\code{file.path(data_dir, schema)}. If \code{data_dir} is \code{NULL},
\code{DATA_DIR} is used as the parent directory.

If \code{schema = NULL}, no schema subdirectory is appended; in this case,
\code{data_dir} (or \code{DATA_DIR}) is treated as the final directory
containing Parquet files.

When \code{schedule} is used, files are selected with the glob pattern
\code{\{prefix\}\{schedule\}_*.parquet} in the resolved directory.

When \code{pq_file} is used, the value is treated as a filename or glob
pattern relative to the resolved directory. If neither \code{data_dir} nor
\code{DATA_DIR} is available, \code{pq_file} may instead be a fully qualified
path to an existing Parquet file.

A fast filesystem check is performed using \code{Sys.glob()}. If no
matching files are found, the function errors before issuing any DuckDB query.
}
