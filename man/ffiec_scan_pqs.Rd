% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ffiec_manifest.R
\name{ffiec_scan_pqs}
\alias{ffiec_scan_pqs}
\title{Scan FFIEC Parquet files into DuckDB}
\usage{
ffiec_scan_pqs(
  conn,
  schedule = NULL,
  pq_file = NULL,
  pq_dir = NULL,
  schema = "ffiec",
  prefix = "",
  union_by_name = TRUE
)
}
\arguments{
\item{conn}{A valid DuckDB connection.}

\item{schedule}{Optional character scalar giving the FFIEC schedule
name (e.g. \code{"rc"}, \code{"rci"}, \code{"rcb"}. All matching Parquet files
of the form \code{\{prefix\}\{schedule\}_YYYYMMDD.parquet} will be scanned.}

\item{pq_file}{Optional character scalar giving a specific Parquet
filename or glob pattern relative to `pq_dir`.}

\item{pq_dir}{Directory containing FFIEC Parquet files. If `NULL`,
defaults to the resolved output directory for `schema`.}

\item{schema}{Schema name used to resolve default directories
(default \code{"ffiec"}).}

\item{prefix}{Optional filename prefix used when the Parquet files
were created (default \code{""}).}

\item{union_by_name}{Logical; whether to union Parquet files by column
name when scanning multiple files (passed to DuckDB's
\code{read_parquet()}). Default is \code{TRUE}.}
}
\value{
A lazy `tbl` backed by DuckDB.
}
\description{
Create a lazy \code{tbl} backed by DuckDB by scanning one or more FFIEC
Parquet files. Files are selected either by schedule name (using a
glob pattern) or by an explicit Parquet filename. No data is read
eagerly; evaluation occurs only when the result is collected.
}
\details{
This function is intended for use with Parquet files produced by
[ffiec_process()]. It validates that the requested files exist on
disk before constructing the DuckDB query.


Exactly one of `schedule` or `pq_file` must be supplied.

When `schedule` is used, files are located using a glob pattern:
\code{\{prefix\}\{schedule\}_*.parquet}. When \code{pq_file} is used, the value is
treated as a filename or glob pattern relative to \code{pq_dir}.

A fast filesystem check is performed using \code{Sys.glob()}. If no files
match, the function errors before issuing any DuckDB query.
}
\examples{
\dontrun{
con <- DBI::dbConnect(duckdb::duckdb())

# Scan all RC schedule files
rc <- ffiec_scan_pqs(con, schedule = "rc")

# Scan a single Parquet file
por <- ffiec_scan_pqs(con, pq_file = "por_20231231.parquet")

# Work lazily
rc |> dplyr::count(date)
}

}
